<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Triple Triad</title>
		<link rel="stylesheet" href="game.css">
		<style type="text/css">
		#canvasBg { display: none; }
		</style>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<script type="text/javascript">
			document.Triad = {}; // create a namespace
			$(document).ready(function() {
				$("#loginButton").click(function() {
					if (document.Triad.validateForm()) {
				
						var exported = document.Triad.Game();
						exported.init(document.forms["myForm"]["username"].value);
						
						// Runs startGame first, waits until finished,
						// then runs printResults
						exported.startGame().done(printResults);
						
						function printResults() {
							console.log("Printing from index.html:");
							// This will eventually update the database with the received information
							var playerScore = exported.getPlayerScore();
							var enemyScore = exported.getEnemyScore();
							var chosenCard = exported.getChosenCard();
							
							if (playerScore > enemyScore) {
								console.log("The player won the game and obtained the " + chosenCard.name + " card.");
							} else if (playerScore < enemyScore){
								console.log("The player lost the game and lost the " + chosenCard.name +  " card.");
							} else {
								console.log("It was a tie game!");
							}
						}
						
						
					} else {
						// Form was not valid
					}
				});
			});
			
		</script>
	</head>
	<body>
		<div id="loginUI">
		<form name="myForm" onsubmit="return document.Triad.validateForm()" method="post">
			<h2>Login Form</h2>
			<input type="text" name="username" />  <br />
			<input type="password" name="password" />  <br />
			<!--<input type="submit" value="Login">-->
			
		</form>
		
		<button id="loginButton">Login</button>
		</div>
		
		<script> 
			document.Triad.validateForm = function() {
				var x = document.forms["myForm"]["username"].value;
				var y = document.forms["myForm"]["password"].value;
				// regular expression
				var ck_username = /^[A-Za-z0-9_]{1,20}$/;
				var ck_password =  /^[A-Za-z0-9!@#$%^&*()_]{6,20}$/;
				
				if (x == null || x == "" || y == null || y == "") {
					alert("Name and password must be filled out");
					return false;
				}
				if (!ck_username.test(x)) {
					alert("no special character is allowed");
					return false;
				}
				if (!ck_password.test(y)) {
					alert("invalid password.  It needs to be at least 6 characters in length");
					return false;
				}
				if ( x != "hdao" && y != "dgmonster"){
					alert("invalid username or password");
					return false;
				}else{
					//alert("login success");
					
					// Hide the login form
					$("#loginUI").css('display', 'none');
					
					// make the canvas element visible (by changing its display attribute back to 'block')
					$("#canvasBg").css("display", "block");
					
					// call the game's init() method
					//window.init();

					document.Triad.Functions = document.Triad.Game();
				
					if (!document.Triad.Functions) {
						alert("Functions do not exist yet");
					} else {
						var card = document.Triad.Functions.testcom()
						alert(card[0].name + " and number copy is " + card[0].numCopy);
						
						$.ajaxSetup({
							jsonp: null,
							jsonpCallback: null
						});
						// function to send request
						// example to send an array as JSON 
						/*
						var myArray = [1, 2, 3];
						var myJson = JSON.stringify(myArray);

						*/
						// turn it into string
						var monstJ = JSON.stringify(card);
						
						$(document).ready(function(){
							$.ajax({
								type: 'POST',
								url: 'test.php',
								dataType: 'json',
								data: {
									monsterId: monstJ
								},    
								success: function (data) {    
									//alert("success");  
									alert(JSON.stringify(data));	
								},
								error: function () {
									alert("could not send data as JSON (failure)");
								}
							});
						});

					}
					
					/*var card = document.Triad.Functions.testcom();
					
					$.ajaxSetup({
							   jsonp: null,
							   jsonpCallback: null
					   });
						var monstJ = JSON.stringify(card);
                                               
						   $(document).ready(function(){
								   $.ajax({
										   type: 'POST',
										   url: 'test.php',
										   dataType: 'json',
										   data: {
												   monsterId: monstJ
										   },    
										   success: function (data) {    
												   //alert("success");  
												   alert(data);        
										   },
										   error: function () {
												   alert("could not send data as JSON (failure)");
										   }
								   });
						   });*/
				   
				   return true;
				}
				
			}
			
			
		</script>
		
		<canvas id="canvasBg" width="768px" height="560px"></canvas>
		<script src="js/game.js"></script>
		
		
		
	</body>
</html>